asyncapi: 3.0.0
info:
  title: Operativt uppgiftslager Async API
  version: 1.1.0
  description: Operativt uppgiftslager för hantering av manuella uppgifter utförda av handläggare

channels:
  operativt.uppgiftslager.requests:
    messages:
      OperativtUppgiftslagerRequestMessage:
        $ref: '#/components/messages/OperativtUppgiftslagerRequestMessage'
  operativt.uppgiftslager.responses:
    messages:
      OperativtUppgiftslagerResponseMessage:
        $ref: '#/components/messages/OperativtUppgiftslagerResponseMessage'
  operativt.uppgiftslager.status.control:
    messages:
      OperativtUppgiftslagerStatusMessage:
        $ref: '#/components/messages/OperativtUppgiftslagerStatusMessage'
  operativt.uppgiftslager.status.notification:
    messages:
      OperativtUppgiftslagerStatusMessage:
        $ref: '#/components/messages/OperativtUppgiftslagerStatusMessage'

operations:
  onOperativtUppgiftslagerRequest:
    action: receive
    channel:
      $ref: '#/channels/operativt.uppgiftslager.requests'
    reply:
      address:
        description: Topic där response ska skickas
        location: "$message.header#/replyTo"
      channel:
        $ref: '#/channels/operativt.uppgiftslager.responses'
  operativtUppgiftslagerStatusControl:
    action: receive
    channel:
      $ref: '#/channels/operativt.uppgiftslager.status.control'
    summary: Hanterar statusuppdateringar
  operativtUppgiftslagerStatusNotification:
    action: send
    channel:
      $ref: '#/channels/operativt.uppgiftslager.status.notification'
    summary: Publicerar statusuppdateringar

components:
  messages:
    OperativtUppgiftslagerRequestMessage:
      payload:
        title: OperativtUppgiftslagerRequestMessage
        $ref: "#/components/schemas/OperativtUppgiftslagerRequestMessage"

    OperativtUppgiftslagerResponseMessage:
      headers:
        $ref: "#/components/schemas/OperativtUppgiftslagerResponseMessageHeaders"
      payload:
        title: OperativtUppgiftslagerResponseMessage
        $ref: "#/components/schemas/OperativtUppgiftslagerResponseMessage"

    OperativtUppgiftslagerStatusMessage:
      payload:
        title: OperativtUppgiftslagerStatusMessage
        type: object
        required:
          - kundbehovsflode_id
          - uppgift_id
          - status
        properties:
          kundbehovsflode_id:
            type: string
            format: uuid
            description: Unikt ID som identifierar kundbehovsflödet
          uppgift_id:
            type: string
            format: uuid
            description: Unikt ID som identifierar instansen av uppgifts-objektet
          status:
            title: status
            type: string
            description: Status för uppgiften
            enum:
              - Ny
              - Tilldelad
              - Avslutad

  schemas:
    OperativtUppgiftslagerRequestMessage:
      type: object
      title: OperativtUppgiftslagerRequestMessage
      required:
        - version
        - kundbehovsflode_id
        - regeltyp
      properties:
        version:
          type: string
          description: Regelns version
        kundbehovsflode_id:
          type: string
          format: uuid
          description: Unikt ID som identifierar kundbehovsflödet
        kundbehov:
          type: string
          description: Namn på kundbehov
        regel:
          type: string
          description: Namn på regeln
        uppgiftsbeskrivning:
          type: string
          description: Kortfattad beskrivning av uppgiften
        verksamhetslogik:
          type: string
        roll:
          type: string
        url:
          type: string

    OperativtUppgiftslagerResponseMessageHeaders:
      type: object
      properties:
        correlationId:
          type: string
          format: uuid
          description: Unikt id som kopplar ihop request & response

    OperativtUppgiftslagerResponseMessage:
      type: object
      title: OperativtUppgiftslagerResponseMessage
      properties:
        uppgift_id:
          type: string
          format: uuid
          description: Unikt ID som identifierar instansen av uppgifts-objektet
        kundbehovsflode_id:
          type: string
          format: uuid
          description: Unikt ID som identifierar kundbehovsflödet
